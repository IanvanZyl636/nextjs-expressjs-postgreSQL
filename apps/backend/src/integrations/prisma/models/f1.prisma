model Season {
  id         Int      @id @default(autoincrement())
  year       Int      @unique
  championId String
  champion   Driver   @relation("ChampionDriver", fields: [championId], references: [driverId])
  races      Race[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Race {
  id                  Int      @id @default(autoincrement())
  seasonId            Int
  name                String
  round               Int
  startedAt           DateTime
  points              Int
  laps                Int
  circuitId           String
  winnerId            String
  winnerConstructorId String

  circuit           Circuit     @relation(fields: [circuitId], references: [circuitId])
  winner            Driver      @relation("RaceWinner", fields: [winnerId], references: [driverId])
  winnerConstructor Constructor @relation("RaceWinnerConstructor", fields: [winnerConstructorId], references: [constructorId])
  season            Season      @relation(fields: [seasonId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([seasonId, round])
}

model Circuit {
  circuitId   String @id
  circuitName String
  locationId  Int    @unique

  location Location @relation(fields: [locationId], references: [id])
  races    Race[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Location {
  id       Int    @id @default(autoincrement())
  lat      String
  long     String
  locality String
  country  String

  circuit Circuit?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([lat, long])
}

model Constructor {
  constructorId String @id
  name          String @unique
  nationality   String

  raceWinnerConstructors Race[] @relation("RaceWinnerConstructor")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Driver {
  driverId    String @id
  fullName    String
  code        String
  nationality String

  racesWon      Race[]   @relation("RaceWinner")
  championships Season[] @relation("ChampionDriver")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
